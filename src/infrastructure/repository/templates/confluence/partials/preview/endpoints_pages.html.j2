{# Single Endpoint Page - Preview Wrapper #}
{# This wraps the standard operation partial with Confluence page styling #}
{% set confluence_preview = true %}

{% for tag in api.tags %}
    {% for path, path_item in api.paths.items() %}
        {% for method, operation in path_item.operations.items() %}
            {% if tag.name in operation.tags %}
            {% set endpoint_id = (tag.name + '-' + method + '-' + path)|replace('/', '-')|replace('{', '')|replace('}', '') %}

            <div id="page-endpoint-{{ endpoint_id }}" class="page-content" style="display:none;">
                <div class="page-header">
                    <h1 class="page-title">
                        <span class="http-method method-{{ method.lower() }}">{{ method.upper() }}</span>
                        {{ path }}
                    </h1>
                    <div class="page-metadata">{{ operation.summary or 'Endpoint' }}</div>
                    <div class="page-labels">
                        <span class="label">{{ tag.name }}</span>
                        <span class="label">{{ method.lower() }}</span>
                    </div>
                </div>

                {% if operation.description %}
                <div class="content-section">
                    <p>{{ operation.description }}</p>
                </div>
                {% endif %}

                {# Reuse shared partials with confluence_preview flag #}
                {% include 'partials/parameters.html.j2' %}
                {% include 'partials/request_body.html.j2' %}
                {% include 'partials/responses.html.j2' %}

                {# cURL Example #}
                <div class="content-section">
                    <h2 class="section-title">cURL Example</h2>
                    <div class="code-block">
                        <pre><code class="language-bash">curl -X {{ method.upper() }} '{% if api.servers and api.servers|length > 0 %}{{ api.servers[0].url }}{% else %}https://api.example.com{% endif %}{{ path }}'{% if operation.parameters %}{% for param in operation.parameters %}{% if param.location == 'path' %} # Replace {{ param.name }}{% endif %}{% endfor %}{% endif %} \
  -H 'Accept: application/json'{% if method.lower() in ['post', 'put', 'patch'] %} \
  -H 'Content-Type: application/json'{% if operation.request_body %}{% for content_type, media_obj in operation.request_body.content.items() %}{% if 'json' in content_type %} \
  -d '{% if media_obj.example %}{{ media_obj.example | tojson_pretty | replace("'", "\\'") }}{% elif media_obj.schema %}{{ example_generator.generate_example_json(media_obj.schema) | replace("'", "\\'") }}{% else %}{"key": "value"}{% endif %}'{% endif %}{% endfor %}{% endif %}{% endif %}</code></pre>
                    </div>
                </div>
            </div>

            {% endif %}
        {% endfor %}
    {% endfor %}
{% endfor %}

